<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–¢—Ä–µ–Ω–∞–∂—ë—Ä ‚Äî –†–µ–π—Ç–∏–Ω–≥</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="text-gray-900" style="background:linear-gradient(180deg,#f8fafc,#fff)">
  <div class="max-w-6xl mx-auto p-6">
    <header class="mb-6">
      <h1 class="text-3xl font-bold">–¢—Ä–µ–Ω–∞–∂—ë—Ä ‚Äî —Ä–µ–π—Ç–∏–Ω–≥</h1>
      <nav class="mt-3 flex flex-wrap gap-2 text-sm">
        <a class="px-3 py-1 border rounded-xl" href="./test.html">üìù –¢–µ—Å—Ç-20</a>
        <a class="px-3 py-1 border rounded-xl" href="./theory.html">üìò –¢–µ–æ—Ä–∏—è</a>
        <a class="px-3 py-1 border rounded-xl" href="./examples.html">üß© 10 –ø—Ä–∏–º–µ—Ä–æ–≤</a>
      </nav>
    </header>

    <section class="rounded-2xl border bg-white p-4">
      <div class="font-semibold mb-2">üèÜ –†–µ–π—Ç–∏–Ω–≥ (—Ç–æ–ø-50)</div>
      <div class="overflow-x-auto">
        <table class="text-sm w-full">
          <thead><tr>
            <th class="px-2 py-1">#</th>
            <th class="px-2 py-1">–ò–º—è</th>
            <th class="px-2 py-1">–ö–æ–º–∞–Ω–¥–∞</th>
            <th class="px-2 py-1">–û—á–∫–∏</th>
            <th class="px-2 py-1">–í–µ—Ä–Ω–æ</th>
            <th class="px-2 py-1">–í—Ä–µ–º—è</th>
            <th class="px-2 py-1">–ö–æ–≥–¥–∞</th>
          </tr></thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
      <div id="ratingStatus" class="mt-2 text-sm opacity-70"></div>
    </section>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";
    import { getFirestore, collection, query, orderBy, limit, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

    const firebaseConfig = {"apiKey": "AIzaSyCj3uUUqGKZ2CalH-v3So6OjU_-eZH7tUc", "authDomain": "pp10-79133.firebaseapp.com", "projectId": "pp10-79133", "storageBucket": "pp10-79133.firebasestorage.app", "messagingSenderId": "179048880378", "appId": "1:179048880378:web:0510340ddfb5f639b01143", "measurementId": "G-QCX9BD9KY2"};

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    await signInAnonymously(auth);
    const db = getFirestore(app);
    document.getElementById('ratingStatus').textContent = "–°–æ–µ–¥–∏–Ω–µ–Ω–æ —Å Firebase. –ñ–∏–≤–æ–π —Ä–µ–π—Ç–∏–Ω–≥ –≤–∫–ª—é—á—ë–Ω.";

    const q = query(
      collection(db,'attempts'),
      orderBy('points','desc'),
      orderBy('durationMs','asc'),
      orderBy('createdAt','desc'),
      limit(50)
    );

    const tbody = document.getElementById('tbody');
    onSnapshot(q, (snap)=>{
      const rows=[]; let i=1;
      snap.forEach(doc=>{
        const a=doc.data(); 
        rows.push({
          rank:i++,
          name:a.name||'‚Äî',
          team:a.team||'',
          points:a.points||0,
          correct:a.correct||0,
          total:a.total||0,
          durationMs:a.durationMs||0,
          createdAt:a.createdAt?.toDate ? a.createdAt.toDate(): new Date()
        });
      });
      let html='';
      rows.forEach(r=>{
        html += '<tr class="border-t">'
          + '<td class="px-2 py-1">'+r.rank+'</td>'
          + '<td class="px-2 py-1">'+String(r.name).replace(/</g,'&lt;')+'</td>'
          + '<td class="px-2 py-1">'+(r.team||'‚Äî')+'</td>'
          + '<td class="px-2 py-1">'+r.points+'</td>'
          + '<td class="px-2 py-1">'+r.correct+'/'+r.total+'</td>'
          + '<td class="px-2 py-1">'+Math.round(r.durationMs/1000)+' c</td>'
          + '<td class="px-2 py-1">'+r.createdAt.toLocaleString('ru-RU')+'</td>'
          + '</tr>';
      });
      if (!html) html = '<tr><td colspan="7" class="px-2 py-3 opacity-70">–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ–ø—ã—Ç–æ–∫</td></tr>';
      tbody.innerHTML = html;
    });
  </script>
</body>
</html>
